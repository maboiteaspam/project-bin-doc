<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/maboiteaspam/Bureau/project-bin-doc/index.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /home/maboiteaspam/Bureau/project-bin-doc/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
#!/usr/bin/env node

var path = require(&#x27;path&#x27;);
var _ = require(&#x27;underscore&#x27;);
var _s = require(&#x27;underscore.string&#x27;);
var program = require(&#x27;commander&#x27;);
var Config = require(&quot;project-bin-config&quot;);
var Cluc = require(&#x27;cluc&#x27;);
var Transport = Cluc.transports.process;


//region Program

var projectPath = process.cwd();
var pkg = require(path.join(projectPath, &#x27;package.json&#x27;) );

var releaseType;
var revision = pkg.version;
var tmpPath;
var sshUrl = pkg.repository.url.replace(/https?:\/\//,&#x27;ssh://git@&#x27;);

program
  .version(require(path.join(__dirname, &#x27;package.json&#x27;) ).version)
  .usage(&#x27;[env]&#x27;)
  .description(&#x27;Generate documentation&#x27;)
  .arguments(&#x27;[env]&#x27;)
  .parse(process.argv);

var env = !program.env?&#x27;local&#x27;:program.env;

(new Config()).load().get(env)
  .forEach(function(machine){

    _.defaults(
      machine.profileData.doc,{
      jsdoc:{paths:[]},
      jsdox:{paths:[]},
      yuidoc:{paths:[]},
      apidoc:{paths:[]},
      docco:{paths:[]}
    });

    var docConfig = machine.profileData.doc;

    var line = new Cluc();
    line
      .ensureFileContains(&#x27;.gitignore&#x27;, &#x27;\n.local.json\n&#x27;)
      .ensureFileContains(&#x27;.gitignore&#x27;, &#x27;\n.idea/\n&#x27;)

      .readFile(&#x27;./version&#x27;, function(err, content){
        var rev = &#x27;-&#x27;;
        var type = &#x27;-&#x27;;
        if(!err){
          content = _s.trim(content);
          type = content.match(/^([^\s]+)/)[1];
          rev = content.match(/\s+([^\s]+)$/)[1];
        }else{
          rev = pkg.version;
        }
        this.saveValue(&#x27;releaseType&#x27;, type);
        this.saveValue(&#x27;revision&#x27;, rev);

      }).then(function(next){
        if(!pkg.name){
          throw &#x27;pkg.name is missing&#x27;;
        }
        if(!pkg.repository){
          throw &#x27;pkg.repository is missing&#x27;;
        }
        this.saveValue(&#x27;pkgName&#x27;, pkg.name);
        this.saveValue(&#x27;pkgRepository&#x27;, pkg.repository);
        this.saveValue(&#x27;projectPath&#x27;, projectPath);
        this.saveValue(&#x27;sshUrl&#x27;, sshUrl);
        this.saveValue(&#x27;gitAuth&#x27;, machine.profileData.github);
        this.saveValue(&#x27;ghBranch&#x27;, docConfig.ghBranch);
        this.saveValue(&#x27;jsdox&#x27;, docConfig.jsdox);
        this.saveValue(&#x27;jsdoc&#x27;, docConfig.jsdoc);
        this.saveValue(&#x27;yuidoc&#x27;, docConfig.yuidoc);
        this.saveValue(&#x27;docco&#x27;, docConfig.docco);
        this.saveValue(&#x27;apidoc&#x27;, docConfig.apidoc);
        this.saveValue(&#x27;mocha&#x27;, docConfig.mocha);
        next();

      }).title(&#x27;&#x27;, &#x27;Generating documentation \n&#x27; +
      &#x27;on &lt;%=ghBranch%&gt; for &lt;%=releaseType%&gt; &lt;%=revision%&gt;&#x27;)

      .mktemp(pkg.name, function(err, tmpDir){
        this.display();
        this.dieOnError();
        tmpPath = tmpDir;
        this.saveValue(&#x27;tmpPath&#x27;, tmpPath);

      }).stream(&#x27;cd &lt;%=tmpPath%&gt;&#x27;, function(){
        this.display();

        /**
         *  Repository preparation
         */
      }).stream(&#x27;git clone &lt;%=sshUrl%&gt; .&#x27;, function(){
        this.warn(/fatal:/);
        this.display();
      }).stream(&#x27;git checkout &lt;%=ghBranch%&gt;&#x27;, function(){
        this.warn(/fatal:/);
        this.display();
      }).stream(&#x27;git checkout -b &lt;%=ghBranch%&gt;&#x27;, function(){
        this.warn(/fatal:/);
        this.display();

      }).stream(&#x27;rm -fr &lt;%=tmpPath%&gt;/*&#x27;, function(){
      }).stream(&#x27;ls -alh&#x27;, function(){
        this.warn(/fatal:/);
        this.display();

        /**
         *  README
         */
      }).putFile(&#x27;&lt;%=projectPath%&gt;/README.md&#x27;, &#x27;&lt;%=tmpPath%&gt;/README.md&#x27;, function(){
        this.warn(/fatal:/);
        this.success(/(est propre|is clean)/i, &#x27;Everything up-to-date&#x27;);
        this.display();

        /**
         *  JsDox
         */
      }).skip(docConfig.jsdox.paths.length)
      .each(docConfig.jsdox.paths, function(from, to){
        line.stream(&#x27;jsdox -r --output &lt;%=tmpPath%&gt;/&#x27;+to+&#x27; &lt;%=projectPath%&gt;/&#x27;+from, function(){
          this.spinUntil(/.+/);
          this.success(&#x27;completed&#x27;);
          this.display();
        });

        /**
         *  JsDoc
         */
      }).skip(docConfig.jsdoc.paths.length)
      .each(docConfig.jsdoc.paths, function(from, to){
        line.stream(&#x27;jsdoc -r &lt;%=projectPath%&gt;/&#x27;+from+&#x27; -d &lt;%=tmpPath%&gt;/&#x27;+to, function(){
          this.spinUntil(/.+/);
          this.success(&#x27;completed&#x27;);
          this.display();
        });

        /**
         *  YuiDoc
         */
      }).skip(docConfig.yuidoc.paths.length)
      .each(docConfig.yuidoc.paths, function(from, to){
        var cmd = &#x27;yuidoc &#x27;;
        cmd += &#x27;-o &lt;%=tmpPath%&gt;/&#x27;+to+&#x27; &#x27;;
        cmd += &#x27;-c &lt;%=projectPath%&gt;/package.json &#x27;;
        if(docConfig.yuidoc.selleck){
          cmd += &#x27;--selleck &#x27;;
        }
        if(docConfig.yuidoc.lint){
          cmd += &#x27;--lint &#x27;;
        }
        if(docConfig.yuidoc.themedir){
          cmd += &#x27;-t &quot;&#x27;+docConfig.yuidoc.themedir+&#x27;&quot; &#x27;;
        }
        if(docConfig.yuidoc.exclude){
          cmd += &#x27;-x &quot;&#x27;+docConfig.yuidoc.exclude.join(&#x27;,&#x27;)+&#x27;&quot; &#x27;;
        }
        if(docConfig.yuidoc.theme){
          cmd += &#x27;-T &quot;&#x27;+docConfig.yuidoc.theme+&#x27;&quot; &#x27;;
        }
        if(docConfig.yuidoc.syntaxtype){
          cmd += &#x27;--syntaxtype &quot;&#x27;+docConfig.yuidoc.syntaxtype+&#x27;&quot; &#x27;;
        }
        cmd += &#x27;&lt;%=projectPath%&gt;/&#x27;+from+&#x27; &#x27;;
        line.stream(cmd, function(){
          this.spinUntil(/.+/);
          this.success(&#x27;completed&#x27;);
          this.display();
        });

        /**
         *  docco
         */
      }).skip(docConfig.docco.paths.length)
      .each(docConfig.docco.paths, function(from, to){
        var cmd = &#x27;docco &#x27;;
        cmd += &#x27;-o &lt;%=tmpPath%&gt;/&#x27;+to+&#x27; &#x27;;
        if(docConfig.docco.layout){
          cmd += &#x27;-l &quot;&#x27;+docConfig.docco.layout+&#x27;&quot; &#x27;;
        }
        if(docConfig.docco.template){
          cmd += &#x27;-t &quot;&#x27;+docConfig.docco.template+&#x27;&quot; &#x27;;
        }
        if(docConfig.docco.extension){
          cmd += &#x27;-e &quot;&#x27;+docConfig.docco.extension+&#x27;&quot; &#x27;;
        }
        if(docConfig.docco.languages){
          cmd += &#x27;-l &quot;&#x27;+docConfig.docco.languages+&#x27;&quot; &#x27;;
        }
        if(docConfig.docco.marked){
          cmd += &#x27;-m &quot;&#x27;+docConfig.docco.marked+&#x27;&quot; &#x27;;
        }
        cmd += &#x27;&lt;%=projectPath%&gt;/&#x27;+from+&#x27; &#x27;;
        line.stream(cmd, function(){
          this.spinUntil(/.+/);
          this.success(&#x27;completed&#x27;);
          this.display();
        });

        /**
         *  apidoc
         */
      }).skip(docConfig.apidoc.paths.length)
      .each(docConfig.apidoc.paths, function(from, to){
        var cmd = &#x27;apidoc &#x27;;
        if(docConfig.apidoc.filters){
          cmd += &#x27;-f &quot;&#x27;+docConfig.apidoc.filters+&#x27;&quot; &#x27;;
        }
        if(docConfig.apidoc.template){
          cmd += &#x27;-t &quot;&#x27;+docConfig.apidoc.template+&#x27;&quot; &#x27;;
        }
        cmd += &#x27;-o &lt;%=tmpPath%&gt;/&#x27;+to+&#x27; &#x27;;
        cmd += &#x27;-i &lt;%=projectPath%&gt;/&#x27;+from+&#x27; &#x27;;
        line.stream(cmd, function(){
          this.spinUntil(/.+/);
          this.success(&#x27;completed&#x27;);
          this.display();
        });

        /**
         *  MOCHA
         */
      }).stream(&#x27;cd &lt;%=projectPath%&gt;&#x27;, function(){
      }).skip(!docConfig.mocha)
      .stream(&#x27;mocha --reporter markdown &gt; &lt;%=tmpPath%&gt;/mocha-toc.md&#x27;, function(){
        this.spinUntil(/.+/);
        this.success(&#x27;completed&#x27;);
        this.display();
      }).stream(&#x27;cd &lt;%=tmpPath%&gt;&#x27;, function(){

        /**
         *  Git commit and push
         */
      }).stream(&#x27;git add -A&#x27;, function(){
        this.display();
        sendGhAuth(this);

      }).stream(&#x27;git commit -am &quot;Generate documentation for &lt;%=releaseType%&gt; &lt;%=revision%&gt;&quot;&#x27;, function(){
        this.success(/\[([\w-]+)\s+([\w-]+)]/i,
          &#x27;branch\t\t%s\nnew revision\t%s&#x27;);
        this.success(/([0-9]+)\s+file[^0-9]+?([0-9]+)?[^0-9]+?([0-9]+)?/i,
          &#x27;changed\t%s\nnew\t\t%s\ndeleted\t%s&#x27;);
        this.warn(/(est propre|is clean)/i, &#x27;Nothing to do&#x27;);
        sendGhAuth(this);
        this.display();

      }).stream(&#x27;git -c core.askpass=true push &lt;%=sshUrl%&gt;&#x27;, function(){
        this.warn(/fatal:/);
        this.success(/(est propre|is clean)/i, &#x27;Everything up-to-date&#x27;);
        sendGhAuth(this);
        this.display();

      }).stream(&#x27;git status&#x27;, function(){
        this.warn(/fatal:/);
        this.success(/(est propre|is clean)/i, &#x27;Everything up-to-date&#x27;);
        sendGhAuth(this);
        this.display();

        /**
         *  Clean up
         */
      }).stream(&#x27;cd &lt;%=projectPath%&gt;&#x27;, function(){
        this.display();
      }).rmdir(&#x27;&lt;%=tmpPath%&gt;&#x27;, function(){

      }).run(new Transport());

  });

//endregion


//region Git auth and github release
function sendGhAuth(context){
  var gitAuth = context.getValue(&#x27;gitAuth&#x27;);
  context.answer(/^Username/i, gitAuth.username);
  context.answer(/^Password/i, gitAuth.password);
}
//endregion

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
